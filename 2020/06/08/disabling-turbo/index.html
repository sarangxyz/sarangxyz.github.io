<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>disabling turbo-bost - a few notes</title><meta name=description content="how to go about disabling turbo-boost"><meta name=author content="Sarang Baheti"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"a few notes","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.variadic.xyz\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.variadic.xyz\/2020\/06\/08\/disabling-turbo\/","name":"Disabling turbo bost"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Sarang Baheti"},"headline":"disabling turbo-bost","description":"how to go about disabling turbo-boost","inLanguage":"en","wordCount":1092,"datePublished":"2020-06-08T00:00:00","dateModified":"2020-06-08T00:00:00","image":"https:\/\/www.variadic.xyz\/","keywords":["linux, mbp, macos, windows, cpu"],"mainEntityOfPage":"https:\/\/www.variadic.xyz\/2020\/06\/08\/disabling-turbo\/","publisher":{"@type":"Organization","name":"https:\/\/www.variadic.xyz\/","logo":{"@type":"ImageObject","url":"https:\/\/www.variadic.xyz\/","height":60,"width":60}}}</script><meta property="og:title" content="disabling turbo-bost"><meta property="og:description" content="how to go about disabling turbo-boost"><meta property="og:url" content="https://www.variadic.xyz/2020/06/08/disabling-turbo/"><meta property="og:type" content="website"><meta property="og:site_name" content="a few notes"><meta name=twitter:title content="disabling turbo-bost"><meta name=twitter:description content="how to go about disabling turbo-boost"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.101.0"><link rel=alternate href=https://www.variadic.xyz/index.xml type=application/rss+xml title="a few notes"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.variadic.xyz/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.variadic.xyz/css/syntax.css><link rel=stylesheet href=https://www.variadic.xyz/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-27935503-1","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://www.variadic.xyz/>a few notes</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Notes href=/>Notes</a></li><li><a title=Archive href=/archive/>Archive</a></li><li><a title=Tags href=/tags/>Tags</a></li><li><a title=About href=/about/>About</a></li><li><a title=Disclaimer href=/disclaimer/>Disclaimer</a></li><li><a title=Books href=/books/>Books</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>disabling turbo-bost</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on June 8, 2020</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>This is just for my notes on how I went about figuring out how disabling Intel&rsquo;s turboboost on my Mac Book Pro to contain the heat. <a href=/2020/05/28/2011mbp-osx/>2011 MacBook Pro & OSX</a></p><p><a href=https://www.dasher.com/intel-turbo-boost-and-how-it-relates-to-high-performance-computing-clusters/>Link1</a> and <a href=https://www.intel.com/content/www/us/en/support/articles/000007359/processors/intel-core-processors.html>Link2</a> have some nice details about turbo-boost.</p><p><a href="https://youtu.be/5aQ0ECZOrHU?t=1970">A nice overview of TurboBoost in Intel Sandy Bridge at HotChips 23</a></p><h3 id=intel-manuals--msr>Intel Manuals & MSR:</h3><hr><p>one can find description of ModelSpecific Register (MSR), Sandy Bridge onwards, in <code>64-ia-32-architectures-software-developer-vol-3b-part-2-manual.pdf</code> in <code>Power and Thermal Management</code> chapter:</p><p>Just look for details on: <code>MSR IA32_MISC_ENABLE</code> in <code>64-ia-32-architectures-software-developer-vol-3b-part-2-manual.pdf</code></p><blockquote><h4 id=14321-discover-hardware-support-and-enabling-of-opportunistic-processor-operation>14.3.2.1 Discover Hardware Support and Enabling of Opportunistic Processor Operation</h4><hr><p>If an Intel 64 processor has hardware support for opportunistic processor performance operation, the power-on default state of A32_MISC_ENABLE[38] indicates the presence of such hardware support. For Intel 64 processors that support opportunistic processor performance operation, the default value is 1, indicating its presence. For processors that do not support opportunistic processor performance operation, the default value is 0. The power-on default value of IA32_MISC_ENABLE[38] allows BIOS to detect the presence of hardware support of opportunistic processor performance operation.</p><p>IA32_MISC_ENABLE[38] is shared across all logical processors in a physical package. It is written by BIOS during platform initiation to enable/disable opportunistic processor operation in conjunction of OS power management capabilities, see Section 14.3.2.2. BIOS can set IA32_MISC_ENABLE[38] with 1 to disable opportunistic processor performance operation; it must clear the default value of IA32_MISC_ENABLE[38] to 0 to enable opportunistic processor performance operation. OS and applications must use CPUID leaf 06H if it needs to detect processors that has opportunistic processor operation enabled.</p><p>When CPUID is executed with EAX = 06H on input, Bit 1 of EAX in Leaf 06H (i.e. CPUID.06H:EAX[1]) indicates opportunistic processor performance operation, such as IDA, has been enabled by BIOS.</p><p>Opportunistic processor performance operation can be disabled by setting bit 38 of IA32_MISC_ENABLE. This mechanism is intended for BIOS only. If IA32_MISC_ENABLE[38] is set, CPUID.06H:EAX[1] will return 0.</p></blockquote><p>More details can be found in Manual Volume 4: Model-Specific Registers <a href=https://software.intel.com/content/dam/develop/public/us/en/documents/335592-sdm-vol-4.pdf><code>335592-sdm-vol-4.pdf</code></a>:</p><blockquote><h4 id=21-architectural-msrs>2.1 ARCHITECTURAL MSRS</h4><hr><p>Many MSRs have carried over from one generation of IA-32 processors to the next and to Intel 64 processors. A subset of MSRs and associated bit fields, which do not change on future processor generations, are now considered architectural MSRs. For historical reasons (beginning with the Pentium 4 processor), these “architectural MSRs” were given the prefix “IA32_”. Table 2-2 lists the architectural MSRs, their addresses, their current names, their names in previous IA-32 processors, and bit fields that are considered architectural. MSR addresses outside Table 2-2 and certain bit fields in an MSR address that may overlap with architectural MSR addresses are model-specific. Code that accesses a model-specific MSR and that is executed on a processor that does not support that MSR will generate an exception.</p></blockquote><p>However, the most interesting note is in <code>Table 2-3. MSRs in Processors Based on Intel® Core™ Microarchitecture</code>:</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>Register Addr
</span></span><span style=display:flex><span>Hex   Dec     Register Name/BitFields       Shared/Unique   Description
</span></span><span style=display:flex><span>1A0H  416     IA32_MISC_ENABLE                              Enable Misc. Processor Features (R/W)
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>                38                          Shared          IDA Disable (R/W)
</span></span><span style=display:flex><span>                                                            When set to 1 on processors that support IDA, the Intel
</span></span><span style=display:flex><span>                                                            Dynamic Acceleration feature (IDA) is disabled and the
</span></span><span style=display:flex><span>                                                            IDA_Enable feature flag will be cleared (CPUID.06H:
</span></span><span style=display:flex><span>                                                            EAX[1]=0).
</span></span><span style=display:flex><span>                                                            When set to a 0 on processors that support IDA,
</span></span><span style=display:flex><span>                                                            CPUID.06H: EAX[1] reports the processor’s support of IDA
</span></span><span style=display:flex><span>                                                            is enabled.
</span></span><span style=display:flex><span>                                                            Note: The power-on default value is used by BIOS to
</span></span><span style=display:flex><span>                                                            detect hardware support of IDA. If the power-on default
</span></span><span style=display:flex><span>                                                            value is 1, IDA is available in the processor. If the poweron 
</span></span><span style=display:flex><span>                                                            default value is 0, IDA is not available
</span></span></code></pre></td></tr></table></div></div><p>A nice answer <a href=https://stackoverflow.com/a/53356512>without intel_pstate at stackoverflow</a></p><p>Linux kernel has a driver to just do this: <code>intel_pstate</code> (<a href=https://www.kernel.org/doc/html/v4.12/admin-guide/pm/intel_pstate.html)>https://www.kernel.org/doc/html/v4.12/admin-guide/pm/intel_pstate.html)</a>, look for <code>no_turbo</code>.</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#111>echo</span> <span style=color:#d88200>&#34;1&#34;</span> <span style=color:#111>|</span> sudo tee /sys/devices/system/cpu/intel_pstate/no_turbo 
</span></span></code></pre></td></tr></table></div></div><p>These are various settings supported by <a href=https://www.kernel.org/doc/Documentation/cpu-freq/intel-pstate.txt><code>intel_pstate</code> driver</a>:</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sarang@mbp:~$ ls /sys/devices/system/cpu/intel_pstate/
</span></span><span style=display:flex><span>max_perf_pct  min_perf_pct  no_turbo  num_pstates  status  turbo_pct
</span></span></code></pre></td></tr></table></div></div><p>Interesting enough, here is some code that points to exactly how things are setup:</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//https://github.com/torvalds/linux/blob/d8924c0d76aaa52e4811b5c64115d9a7f36cc73a/drivers/platform/x86/intel_ips.c
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Package level MSRs for monitor/control
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define PLATFORM_INFO	0xce
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define   PLATFORM_TDP		(1&lt;&lt;29)
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define   PLATFORM_RATIO	(1&lt;&lt;28)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define IA32_MISC_ENABLE	0x1a0
</span></span></span><span style=display:flex><span><span style=color:#75715e>#define   IA32_MISC_TURBO_EN	(1ULL&lt;&lt;38)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#111>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * ips_detect_cpu - detect whether CPU supports IPS
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Walk our list and see if we&#39;re on a supported CPU.  If we find one,
</span></span></span><span style=display:flex><span><span style=color:#75715e> * return the limits for it.
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>static</span> <span style=color:#00a8c8>struct</span> <span style=color:#75af00>ips_mcp_limits</span> <span style=color:#f92672>*</span><span style=color:#111>ips_detect_cpu</span><span style=color:#111>(</span><span style=color:#00a8c8>struct</span> <span style=color:#75af00>ips_driver</span> <span style=color:#f92672>*</span><span style=color:#111>ips</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#111>u64</span> <span style=color:#111>turbo_power</span><span style=color:#111>,</span> <span style=color:#111>misc_en</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#111>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#111>rdmsrl</span><span style=color:#111>(</span><span style=color:#111>IA32_MISC_ENABLE</span><span style=color:#111>,</span> <span style=color:#111>misc_en</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * If the turbo enable bit isn&#39;t set, we shouldn&#39;t try to enable/disable
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * turbo manually or we&#39;ll get an illegal MSR access, even though
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * turbo will still be available.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#111>misc_en</span> <span style=color:#f92672>&amp;</span> <span style=color:#111>IA32_MISC_TURBO_EN</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#111>ips</span><span style=color:#f92672>-&gt;</span><span style=color:#111>turbo_toggle_allowed</span> <span style=color:#f92672>=</span> <span style=color:#111>true</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>else</span>
</span></span><span style=display:flex><span>		<span style=color:#111>ips</span><span style=color:#f92672>-&gt;</span><span style=color:#111>turbo_toggle_allowed</span> <span style=color:#f92672>=</span> <span style=color:#111>false</span><span style=color:#111>;</span>
</span></span></code></pre></td></tr></table></div></div><p>From <code>intel_pstate.c</code>:</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#00a8c8>static</span> <span style=color:#111>ssize_t</span> <span style=color:#75af00>store_no_turbo</span><span style=color:#111>(</span><span style=color:#00a8c8>struct</span> <span style=color:#75af00>kobject</span> <span style=color:#f92672>*</span><span style=color:#111>a</span><span style=color:#111>,</span> <span style=color:#00a8c8>struct</span> <span style=color:#75af00>kobj_attribute</span> <span style=color:#f92672>*</span><span style=color:#111>b</span><span style=color:#111>,</span>
</span></span><span style=display:flex><span>			      <span style=color:#00a8c8>const</span> <span style=color:#00a8c8>char</span> <span style=color:#f92672>*</span><span style=color:#111>buf</span><span style=color:#111>,</span> <span style=color:#111>size_t</span> <span style=color:#111>count</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span><span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>unsigned</span> <span style=color:#00a8c8>int</span> <span style=color:#111>input</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>int</span> <span style=color:#111>ret</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#111>ret</span> <span style=color:#f92672>=</span> <span style=color:#111>sscanf</span><span style=color:#111>(</span><span style=color:#111>buf</span><span style=color:#111>,</span> <span style=color:#d88200>&#34;%u&#34;</span><span style=color:#111>,</span> <span style=color:#f92672>&amp;</span><span style=color:#111>input</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#111>ret</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>return</span> <span style=color:#f92672>-</span><span style=color:#111>EINVAL</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#111>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#111>global</span><span style=color:#111>.</span><span style=color:#111>no_turbo</span> <span style=color:#f92672>=</span> <span style=color:#111>clamp_t</span><span style=color:#111>(</span><span style=color:#00a8c8>int</span><span style=color:#111>,</span> <span style=color:#111>input</span><span style=color:#111>,</span> <span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#ae81ff>1</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#111>global</span><span style=color:#111>.</span><span style=color:#111>no_turbo</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>struct</span> <span style=color:#75af00>cpudata</span> <span style=color:#f92672>*</span><span style=color:#111>cpu</span> <span style=color:#f92672>=</span> <span style=color:#111>all_cpu_data</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>];</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>int</span> <span style=color:#111>pct</span> <span style=color:#f92672>=</span> <span style=color:#111>cpu</span><span style=color:#f92672>-&gt;</span><span style=color:#111>pstate</span><span style=color:#111>.</span><span style=color:#111>max_pstate</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span> <span style=color:#f92672>/</span> <span style=color:#111>cpu</span><span style=color:#f92672>-&gt;</span><span style=color:#111>pstate</span><span style=color:#111>.</span><span style=color:#111>turbo_pstate</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>/* Squash the global minimum into the permitted range. */</span>
</span></span><span style=display:flex><span>		<span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#111>global</span><span style=color:#111>.</span><span style=color:#111>min_perf_pct</span> <span style=color:#f92672>&gt;</span> <span style=color:#111>pct</span><span style=color:#111>)</span>
</span></span><span style=display:flex><span>			<span style=color:#111>global</span><span style=color:#111>.</span><span style=color:#111>min_perf_pct</span> <span style=color:#f92672>=</span> <span style=color:#111>pct</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>	<span style=color:#111>}</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#111>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#111>intel_pstate_update_policies</span><span style=color:#111>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#111>...</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></td></tr></table></div></div><p>A few <a href=https://lwn.net/Kernel/Index/#cpufreq>related articles here</a></p><h3 id=os-x-driver>OS X driver:</h3><hr><p>No easy way to do this on OS X. I found <a href=http://tbswitcher.rugarciap.com/>this tool</a> <a href=https://github.com/rugarciap/Turbo-Boost-Switcher>github</a>, which wraps the <a href=https://github.com/nanoant/DisableTurboBoost.kext>kext/driver</a>.</p><p>The <code>kext</code> does the same thing as noted above:</p><div class=highlight><div style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// https://github.com/nanoant/DisableTurboBoost.kext/blob/master/DisableTurboBoost.c
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>//  expectedFeatures stays unused in this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#00a8c8>const</span> <span style=color:#00a8c8>uint64_t</span> <span style=color:#111>expectedFeatures</span>  <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x850089LL</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>const</span> <span style=color:#00a8c8>uint64_t</span> <span style=color:#111>disableTurboBoost</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x4000000000LL</span><span style=color:#111>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>static</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>disable_tb</span><span style=color:#111>(</span><span style=color:#111>__unused</span> <span style=color:#00a8c8>void</span> <span style=color:#f92672>*</span> <span style=color:#111>param_not_used</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#111>wrmsr64</span><span style=color:#111>(</span><span style=color:#111>MSR_IA32_MISC_ENABLE</span><span style=color:#111>,</span> <span style=color:#111>rdmsr64</span><span style=color:#111>(</span><span style=color:#111>MSR_IA32_MISC_ENABLE</span><span style=color:#111>)</span> <span style=color:#f92672>|</span> <span style=color:#111>disableTurboBoost</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#00a8c8>static</span> <span style=color:#00a8c8>void</span> <span style=color:#75af00>enable_tb</span><span style=color:#111>(</span><span style=color:#111>__unused</span> <span style=color:#00a8c8>void</span> <span style=color:#f92672>*</span> <span style=color:#111>param_not_used</span><span style=color:#111>)</span> <span style=color:#111>{</span>
</span></span><span style=display:flex><span>	<span style=color:#111>wrmsr64</span><span style=color:#111>(</span><span style=color:#111>MSR_IA32_MISC_ENABLE</span><span style=color:#111>,</span> <span style=color:#111>rdmsr64</span><span style=color:#111>(</span><span style=color:#111>MSR_IA32_MISC_ENABLE</span><span style=color:#111>)</span> <span style=color:#f92672>&amp;</span> <span style=color:#f92672>~</span><span style=color:#111>disableTurboBoost</span><span style=color:#111>);</span>
</span></span><span style=display:flex><span><span style=color:#111>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=windows-power-config>Windows Power config:</h3><hr><p>With windows, it is quite easy- Just go to power config in power options and control the max freq.</p><p>Note: this switches off the <a href=https://docs.microsoft.com/en-us/windows-hardware/design/device-experiences/modern-standby>Windows Modern Standby</a> feature. I found it to be very cool and decided to not to muck around with these settings on my new laptop.</p><p>Some details here at <a href=https://stackoverflow.com/a/59652063>stack overflow</a>:</p><p>Adding following key allows you to disable <code>Processor Performance boost mode</code></p><pre tabindex=0><code>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\54533251-82be-4824-96c1-47b60b740d00\be337238-0d82-4146-a960-4f3749d470c7]
&#34;Attributes&#34;=dword:00000002
</code></pre><p>Also, one can use tweaking tools like <code>i7 turbo</code> as <a href=http://www.xtremesystems.org/forums/showthread.php?225450-i7-Turbo-Tool-to-test-for-Turbo-throttling>described here</a></p><link rel=stylesheet href=https://www.variadic.xyz/css/hugo-easy-gallery.css><div class=box><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject><div class=img><img itemprop=thumbnail src=/images/i7turbogt.png alt=/images/i7turbogt.png></div><a href=/images/i7turbogt.png itemprop=contentUrl></a></figure></div><div class=blog-tags><a href=https://www.variadic.xyz//tags/linux/>linux</a>&nbsp;
<a href=https://www.variadic.xyz//tags/mbp/>mbp</a>&nbsp;
<a href=https://www.variadic.xyz//tags/macos/>macos</a>&nbsp;
<a href=https://www.variadic.xyz//tags/windows/>windows</a>&nbsp;
<a href=https://www.variadic.xyz//tags/cpu/>cpu</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://www.variadic.xyz/2020/06/03/lmsensors-config/ data-toggle=tooltip data-placement=top title="sensors conf">&larr; Previous Post</a></li><li class=next><a href=https://www.variadic.xyz/2020/06/15/ubuntu-2011mbp/ data-toggle=tooltip data-placement=top title="Ubuntu 20.04 on MacBook Pro 2011">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">Sarang Baheti
&nbsp;&bull;&nbsp;&copy;
2023
&nbsp;&bull;&nbsp;
<a href=https://www.variadic.xyz/>a few notes</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.101.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://www.variadic.xyz/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.variadic.xyz/js/load-photoswipe.js></script></body></html>