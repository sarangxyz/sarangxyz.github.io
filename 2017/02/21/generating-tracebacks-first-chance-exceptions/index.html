<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>generating tracebacks for first chance exceptions - a few notes</title><meta name=description content="generating tracebacks on first chance exceptions with windbg to aid development"><meta name=author content="Sarang Baheti"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"a few notes","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.variadic.xyz\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.variadic.xyz\/2017\/02\/21\/generating-tracebacks-first-chance-exceptions\/","name":"Generating tracebacks for first chance exceptions"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Sarang Baheti"},"headline":"generating tracebacks for first chance exceptions","description":"generating tracebacks on first chance exceptions with windbg to aid development","inLanguage":"en","wordCount":440,"datePublished":"2017-02-21T21:36:45","dateModified":"2017-02-21T21:36:45","image":"https:\/\/www.variadic.xyz\/","keywords":["windows, windbg, debug"],"mainEntityOfPage":"https:\/\/www.variadic.xyz\/2017\/02\/21\/generating-tracebacks-first-chance-exceptions\/","publisher":{"@type":"Organization","name":"https:\/\/www.variadic.xyz\/","logo":{"@type":"ImageObject","url":"https:\/\/www.variadic.xyz\/","height":60,"width":60}}}</script><meta property="og:title" content="generating tracebacks for first chance exceptions"><meta property="og:description" content="generating tracebacks on first chance exceptions with windbg to aid development"><meta property="og:url" content="https://www.variadic.xyz/2017/02/21/generating-tracebacks-first-chance-exceptions/"><meta property="og:type" content="website"><meta property="og:site_name" content="a few notes"><meta name=twitter:title content="generating tracebacks for first chance exceptions"><meta name=twitter:description content="generating tracebacks on first chance exceptions with windbg to aid development"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.101.0"><link rel=alternate href=https://www.variadic.xyz/index.xml type=application/rss+xml title="a few notes"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.variadic.xyz/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.variadic.xyz/css/syntax.css><link rel=stylesheet href=https://www.variadic.xyz/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-27935503-1","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://www.variadic.xyz/>a few notes</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Notes href=/>Notes</a></li><li><a title=Archive href=/archive/>Archive</a></li><li><a title=Tags href=/tags/>Tags</a></li><li><a title=About href=/about/>About</a></li><li><a title=Disclaimer href=/disclaimer/>Disclaimer</a></li><li><a title=Books href=/books/>Books</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>generating tracebacks for first chance exceptions</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on February 21, 2017</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>Recently I was debugging some workflow where it appeared quite slow. As part of debugging i saw it Visual Studio printed debugging information about first chance exceptions thrown.</p><p>Now that <a href=https://docs.microsoft.com/en-us/archive/blogs/davidklinems/what-is-a-first-chance-exception>David Kline from MS</a> has made it ample clear that <a href=http://stackoverflow.com/questions/564681/what-is-a-first-chance-exception>FirstChance exceptions are normal exceptions just that debugger gets first chance at them</a>- thus first chance. If debugger chooses not to do anything then application gets a chance to do something about it. If application does not handle it then debugger gets a second chance, thus second chance exceptions. you get the idea.</p><p>Now an application can throw as many exceptions it wants and catch it later. This is fine but exceptions are supposed to exceptional and cost quite a bit. (<a href=http://stackoverflow.com/questions/13835817/are-exceptions-in-c-really-slow>link1</a> & <a href=http://stackoverflow.com/a/13840188/916549>link2</a>)</p><p>I have seen <a href=http://www.boost.org/doc/libs/1_40_0/libs/conversion/lexical_cast.htm>lexical_cast</a> being the one that throws exceptions just to parse strings, with xml parsing this could be a big source of exceptions.
One of the ways to speed up applications is now to fix or atleast reason about these exceptions being thrown, and having tracebacks makes life lot easier.</p><p>To generate tracebacks is you could use <a href=https://docs.microsoft.com/en-us/windows/win32/debug/vectored-exception-handling>Vectored Exception Handling</a> or <code>windbg</code>. Off course I chose <code>windbg</code> so I set out to generate tracebacks.
In my case I recorded 168K+ exceptions thrown out of which I believe ~165K could be filtered.</p><p>Anyway, as usual I started <code>windbg</code> with a log file option, as traces could get really large and I did not want to lose any.</p><pre tabindex=0><code>windbg -pn testapp.exe -loga d:\tracebacks.txt
</code></pre><p>Once I had application running, next I ensured that I am listening to correct exception code. In my case it is C++ exception with code <code>e06d7363</code>, <a href="https://devblogs.microsoft.com/oldnewthing/20100730-00/?p=13273">some details here</a> and <a href=https://stackoverflow.com/questions/9095898/decoding-the-parameters-of-a-thrown-c-exception-0xe06d7363>here</a>.</p><pre tabindex=0><code>(3770.35a0): Break instruction exception - code 80000003 (first chance)
ntdll!DbgBreakPoint:
00000000`779aafb0 cc              int     3
0:008&gt; g
ModLoad: 000007fe`dcb10000 000007fe`dcb17000   C:\windows\system32\SHFolder.dll
;
;
(3770.378c): C++ EH exception - code e06d7363 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
KERNELBASE!RaiseException+0x39:
000007fe`fd70a06d 4881c4c8000000  add     rsp,0C8h
;
0:000&gt; sxe -c &#34;k;g;&#34; e06d7363
0:000&gt; g
(3770.378c): C++ EH exception - code e06d7363 (first chance)
 # Child-SP          RetAddr           Call Site
00 00000000`0022cd80 000007fe`f65a4572 KERNELBASE!RaiseException+0x39
</code></pre><p>Here I am asking <code>windbg</code> to break whenever a C++ exception is thrown. At <code>line#14</code> command is <code>sxe -c "k;g;" e06d7363</code>.
Which configures <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/controlling-exceptions-and-events>Exceptions and Events in windbg</a>, see <a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/sx--sxd--sxe--sxi--sxn--sxr--sx---set-exceptions->sxe</a> for details.
The idea is to configure exceptions such that we break on error <code>e06d7363</code> but execute command <code>k;g;</code>- print traceback in that particular thread, <code>k</code>, and continue <code>g</code></p><p>That&rsquo;s it. At the end of workflow I had traces for all 168K exceptions with a text file container ~500MB of tracebacks to dig thru.</p><div class=blog-tags><a href=https://www.variadic.xyz//tags/windows/>windows</a>&nbsp;
<a href=https://www.variadic.xyz//tags/windbg/>windbg</a>&nbsp;
<a href=https://www.variadic.xyz//tags/debug/>debug</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://www.variadic.xyz/2017/02/20/logging-off-users-remotely/ data-toggle=tooltip data-placement=top title="logging off users remotely">&larr; Previous Post</a></li><li class=next><a href=https://www.variadic.xyz/2017/03/04/github-multiple-accounts-setup-notes/ data-toggle=tooltip data-placement=top title="github multiple accounts setup notes">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">Sarang Baheti
&nbsp;&bull;&nbsp;&copy;
2022
&nbsp;&bull;&nbsp;
<a href=https://www.variadic.xyz/>a few notes</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.101.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://www.variadic.xyz/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.variadic.xyz/js/load-photoswipe.js></script></body></html>