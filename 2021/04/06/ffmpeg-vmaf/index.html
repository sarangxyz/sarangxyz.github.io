<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>building ffmpeg with vmaf support - a few notes..</title><meta name=description content="building ffmpeg with libvmaf support"><meta name=author content="Sarang Baheti"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"a few notes..","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/www.variadic.xyz\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/www.variadic.xyz\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/www.variadic.xyz\/2021\/04\/06\/ffmpeg-vmaf\/","name":"Building ffmpeg with vmaf support"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Sarang Baheti"},"headline":"building ffmpeg with vmaf support","description":"building ffmpeg with libvmaf support","inLanguage":"en","wordCount":686,"datePublished":"2021-04-06T00:00:00","dateModified":"2021-04-06T00:00:00","image":"https:\/\/www.variadic.xyz\/","keywords":["misc, linux"],"mainEntityOfPage":"https:\/\/www.variadic.xyz\/2021\/04\/06\/ffmpeg-vmaf\/","publisher":{"@type":"Organization","name":"https:\/\/www.variadic.xyz\/","logo":{"@type":"ImageObject","url":"https:\/\/www.variadic.xyz\/","height":60,"width":60}}}</script><meta property="og:title" content="building ffmpeg with vmaf support"><meta property="og:description" content="building ffmpeg with libvmaf support"><meta property="og:url" content="https://www.variadic.xyz/2021/04/06/ffmpeg-vmaf/"><meta property="og:type" content="website"><meta property="og:site_name" content="a few notes.."><meta name=twitter:title content="building ffmpeg with vmaf support"><meta name=twitter:description content="building ffmpeg with libvmaf support"><meta name=twitter:card content="summary_large_image"><meta name=generator content="Hugo 0.101.0"><link rel=alternate href=https://www.variadic.xyz/index.xml type=application/rss+xml title="a few notes.."><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://www.variadic.xyz/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://www.variadic.xyz/css/syntax.css><link rel=stylesheet href=https://www.variadic.xyz/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-27935503-1","auto"),ga("send","pageview"))</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=https://www.variadic.xyz/>a few notes..</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Notes href=/>Notes</a></li><li><a title=Archive href=/archive/>Archive</a></li><li><a title=Tags href=/tags/>Tags</a></li><li><a title=About href=/about/>About</a></li><li><a title=Disclaimer href=/disclaimer/>Disclaimer</a></li><li><a title=Books href=/books/>Books</a></li></ul></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>building ffmpeg with vmaf support</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on April 6, 2021</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><p>A few reference links:</p><ul><li><a href=https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu>https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu</a></li><li><a href=https://ottverse.com/vmaf-ffmpeg-ubuntu-compilation-installation-usage-guide/>https://ottverse.com/vmaf-ffmpeg-ubuntu-compilation-installation-usage-guide/</a></li></ul><hr><p>This is building on linux & wsl. I am running on Ubuntu 20.04 in both cases.</p><p>First, ensure various tools are updated and ensure that you have <code>build-essentials</code> installed. Install <code>python3</code> and <code>pip3</code> for <code>Cython</code> and <code>numpy</code>.</p><p>I have installed <code>meson</code> myself rather than going thru <code>pip3</code>, somehow system was not able to find it where it was install during building <code>libvmaf</code>. It shouldn&rsquo;t matter which way you install as long as it is found during build.</p><pre tabindex=0><code>sudo apt update
sudo apt install python3 python3-pip python3-setuptools python3-wheel ninja-build nasm
sudo apt install meson
sudo apt install zip unzip
</code></pre><hr><p>Next, I downloaded latest <code>vmaf</code> from github repo and extracted in a directory, say <code>~\source\vmaf</code>.</p><pre tabindex=0><code>libvmaf:
get vmaf from github repo (wget https://github.com/Netflix/vmaf/archive/v1.5.2.tar.gz)
extract it locally to a directory
</code></pre><p>// it is installed in location /usr/local/lib/x86_64-linux-gnu</p><pre tabindex=0><code>
----
Once, `libvmaf` is built and installed, it is now time to build `ffmpeg` and it will include the `libvmaf.a` file generated earlier.


First get all dependencies built and installed, we are going to various encoders and their dev-packages to be linked in ffmpeg:
</code></pre><p>sudo apt -y install autoconf automake build-essential cmake git-core
sudo apt -y install libass-dev libfreetype6-dev libgnutls28-dev libsdl2-dev
sudo apt -y install libtool libva-dev libvdpau-dev libvorbis-dev libxcb1-dev
sudo apt -y install libxcb-shm0-dev libxcb-xfixes0-dev meson ninja-build
sudo apt -y install pkg-config texinfo wget yasm zlib1g-dev nasm</p><p>sudo apt -y install libx264-dev libx265-dev libnuma-dev libopus-dev
sudo apt -y install libvpx-dev libfdk-aac-dev libmp3lame-dev</p><pre tabindex=0><code>  \
Next, create couple of directories in to extract source and build: 
</code></pre><p>mkdir -p ~/ffmpeg_sources ~/bin</p><pre tabindex=0><code>  \
Now to build ffmpeg with various support encoders and filters execute below command. It will configure our build and list various filters and encoders it is going to build with:
</code></pre><p>cd ~/ffmpeg_sources
wget -O ffmpeg-snapshot.tar.bz2 <a href=https://ffmpeg.org/releases/ffmpeg-snapshot.tar.bz2>https://ffmpeg.org/releases/ffmpeg-snapshot.tar.bz2</a>
tar xjvf ffmpeg-snapshot.tar.bz2
cd ffmpeg
PATH="$HOME/bin:$PATH"
PKG_CONFIG_PATH="$HOME/ffmpeg_build/lib/pkgconfig"</p><p>./configure &ndash;prefix="$HOME/ffmpeg_build" &ndash;pkg-config-flags="&ndash;static" &ndash;extra-cflags="-I$HOME/ffmpeg_build/include" &ndash;extra-ldflags="-L$HOME/ffmpeg_build/lib" &ndash;extra-libs="-lpthread -lm" &ndash;ld=&ldquo;g++&rdquo; &ndash;bindir="$HOME/bin" &ndash;enable-gpl &ndash;enable-gnutls &ndash;enable-libass &ndash;enable-libfdk-aac &ndash;enable-libfreetype &ndash;enable-libmp3lame &ndash;enable-libopus &ndash;enable-libvorbis &ndash;enable-libvpx &ndash;enable-libx264 &ndash;enable-libx265 &ndash;enable-libvmaf &ndash;enable-nonfree</p><pre tabindex=0><code>  \
It prints a ton of stuff on terminal:
</code></pre><p>install prefix /home/sarang/ffmpeg_build
source path .
C compiler gcc
C library glibc
ARCH x86 (generic)
big-endian no
runtime cpu detection yes
standalone assembly yes
x86 assembler nasm
MMX enabled yes
MMXEXT enabled yes
3DNow! enabled yes
3DNow! extended enabled yes
SSE enabled yes
SSSE3 enabled yes
AESNI enabled yes
AVX enabled yes
AVX2 enabled yes
&mldr;
makeinfo supports HTML yes</p><p>External libraries:
&mldr;</p><p>External libraries providing hardware acceleration:
&mldr;</p><p>Libraries:
avcodec avfilter avutil swresample
avdevice avformat postproc swscale</p><p>Programs:
ffmpeg ffplay ffprobe</p><p>Enabled decoders:
aac bmp iac pcm_f24le stl
&mldr;</p><p>Enabled encoders:
a64multi dnxhd magicyuv pcm_s64be speedhq
&mldr;</p><p>Enabled hwaccels:
&mldr;</p><p>Enabled parsers:
&mldr;</p><p>Enabled demuxers:
&mldr;</p><p>Enabled muxers:
&mldr;</p><p>Enabled protocols:
&mldr;</p><p>Enabled filters:
&mldr;</p><p>Enabled bsfs:
&mldr;</p><p>Enabled indevs:
&mldr;</p><p>Enabled outdevs:
&mldr;</p><p>License: nonfree and unredistributable</p><pre tabindex=0><code>  \
To continue with build and installation, this will take a bit but it will build and install in local user&#39;s directory:
</code></pre><p>PATH="$HOME/bin:$PATH"
make -j4
make install
hash -r</p><pre tabindex=0><code>  \
For me, it installed it in directory: `/home/sarangb/bin/ffmpeg`. Now, it gets fancy if you had installed `ffmpeg` thru `apt install` command earlier. In such case sourcing the `~/.profile` helped with command `source ~/.profile`
 
  \
Checking with the newly built `ffmpeg`, I can see that it has `libvmaf` support. Of course it is a non distributable build for my local consumption.
</code></pre><p>ffmpeg version N-101868-g557953a Copyright (c) 2000-2021 the FFmpeg developers
built with gcc 9 (Ubuntu 9.3.0-17ubuntu1~20.04)
configuration: &ndash;prefix=/home/sarangb/ffmpeg_build &ndash;pkg-config-flags=&ndash;static &ndash;extra-cflags=-I/home/sarangb/ffmpeg_build/include &ndash;extra-ldflags=-L/home/sarangb/ffmpeg_build/lib &ndash;extra-libs=&rsquo;-lpthread -lm&rsquo; &ndash;bindir=/home/sarangb/bin &ndash;enable-gpl &ndash;enable-gnutls &ndash;enable-libass &ndash;enable-libfdk-aac &ndash;enable-libfreetype &ndash;enable-libmp3lame &ndash;enable-libopus &ndash;enable-libvorbis &ndash;enable-libvpx &ndash;enable-libx264 &ndash;enable-libx265 &ndash;enable-libvmaf &ndash;enable-nonfree
libavutil 56. 72.100 / 56. 72.100
libavcodec 58.135.100 / 58.135.100
libavformat 58. 78.100 / 58. 78.100
libavdevice 58. 14.100 / 58. 14.100
libavfilter 7.111.100 / 7.111.100
libswscale 5. 10.100 / 5. 10.100
libswresample 3. 10.100 / 3. 10.100
libpostproc 55. 10.100 / 55. 10.100
Hyper fast Audio and Video encoder
usage: ffmpeg [options] [[infile options] -i infile]&mldr; {[outfile options] outfile}&mldr;</p><pre tabindex=0><code>
----

Now all of above was due to non availability of linux ffmpeg build with vmaf support. On windows, I found that builds from `https://github.com/BtbN/FFmpeg-Builds/releases` include vmaf support and didn&#39;t had to jump thru hoops on windows..
</code></pre><div class=blog-tags><a href=https://www.variadic.xyz//tags/misc/>misc</a>&nbsp;
<a href=https://www.variadic.xyz//tags/linux/>linux</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://www.variadic.xyz/2021/03/26/samba-shares/ data-toggle=tooltip data-placement=top title="connecting samba shares on linux">&larr; Previous Post</a></li><li class=next><a href=https://www.variadic.xyz/2021/04/11/libvmaf-hevc/ data-toggle=tooltip data-placement=top title="using vmaf for encoder quality">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"></ul><p class="credits copyright text-muted">Sarang Baheti
&nbsp;&bull;&nbsp;&copy;
2022
&nbsp;&bull;&nbsp;
<a href=https://www.variadic.xyz/>a few notes..</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.101.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://www.variadic.xyz/js/main.js></script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://www.variadic.xyz/js/load-photoswipe.js></script></body></html>